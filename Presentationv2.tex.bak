\documentclass[a4]{beamer}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{newlfont}
\usepackage{amsmath,amsthm,amsfonts}
%\usepackage{beamerthemesplit}
\usepackage{pgf,pgfarrows,pgfnodes,pgfautomata,pgfheaps,pgfshade}
\usepackage{mathptmx}  % Font Family
\usepackage{helvet}   % Font Family
\usepackage{color}

\mode<presentation> {
 \usetheme{Frankfurt} % was CambridgeUS
 \useinnertheme{rounded}
 \useoutertheme{infolines}
 \usefonttheme{serif}
 %\usecolortheme{wolverine}
% \usecolortheme{rose}
\usefonttheme{structurebold}
}

\setbeamercovered{dynamic}
%
%
%01) What is a method comparison study
%02) Agreement
%03) Bland Altman plot (Intermethod Bias mention Correlation)
%04) Limits of Agreement
%05) Repeatability
%06) PEFR Data
%07) scatterplot of PEFR   [DONE]
%08) BA of PEFR             [DONE]
%09) Repeated measurements
%10) JSR data
%%--------------------------------------------------------------%
%11) LMEs
%12) VC Structures
%13) LMEs Repeated measurements (hamlett)
%14) Roys methods (Three Criteria)
%15) Variability Tests


\title[MCS]{Diagnostic measures for the analysis of method comparison
studies using the linear mixed effects model
 \\ {\normalsize Transfer Report Presentation}}
\author[Kevin O'Brien]{Kevin O'Brien \\ {\scriptsize kevin.obrien@ul.ie}}
\date{November 2010}
\institute[Maths \& Stats]{Dept. of Mathematics \& Statistics, \\ University \textit{of} Limerick}

\renewcommand{\arraystretch}{1.5}

\begin{document}

\begin{frame}
\titlepage
\end{frame}

\section{Method Comparison Studies}
\frame{
Method comparison studies:
\begin{itemize}
  \item Method comparison studies are used to assess the relative agreement between two methods that measure the same variable.\item Agreement is 
      \item Commonly a new method is compared to one currently in use to see whether their measurements are indeed comparable.\item whether these two methods can be used interchangeably
or the new method can replace the established one. \item Very important type of analysis in biomedical sciences.
\end{itemize}

\vspace{0.2cm}
%Agreement between two methods of clinical measurement can be quantified using the differences between observations made using the two methods on the same subjects (Bland and Altman 1999).\\
}

%-------------------------------------------------------------------------------------%
\frame{\frametitle{Bland-Altman plots}
\begin{itemize} \item Bland and Altman (1983) noted the inappropriate use of correlation for method comparison, and developed a simple graphical approach , known as a Bland-Altman plot. \item For measurements from two methods on the same set of subjects, case-wise averages are plotted against case-wise differences.
\item The mean of the case-wise differences serves an estimate for the inter-method bias. 
\item Inter-method bias can be described as the tendency for one method to give a measurement higher than the counterpart method.
\end{itemize}
}



%-------------------------------------------------------------------------------------%
\frame{\frametitle{Inter-method bias}


The mean of the casewise differences is the estimate for the intermethod bias.

\begin{itemize}
 \item Constant Bias
 \item Proportional Bias
\end{itemize}

 http://biopharminternational.findpharma.com/biopharm/data/articlestandard//biopharm/032002/7276/article.pdf
 
Inter-method bias -----
}
%-------------------------------------------------------------------------------------%
\frame{\frametitle{Limits of Agreement}


We obtain the differences between measurements by the two methods for each
individual and calculate the mean and standard deviation. We then estimate the
95\% limits of agreement as the two values mean minus 1.96 standard deviations
and mean plus 1.96 standard deviations.\\ \bigskip


These limits are expected to contain the
difference between measurements by the two methods for 95\% of pairs of future
measurements on similar individuals.
}
%----------------------------------------------------------------------------------------------%
\frame{\frametitle{Limits of Agreement}
The Bland - Altman plot (Bland and Altman, 1986 and 1999), or difference plot, is a graphical method to compare two measurements techniques. In this graphical method the differences (or alternatively the ratios) between the two techniques are plotted against the averages of the two techniques.\\
\vspace{1cm}The graph displays a scatter diagram of the differences plotted against the averages of the two measurements. Horizontal lines are drawn at the mean difference, and at the limits of agreement, which are defined as the mean difference plus and minus 1.96 times the standard deviation of the differences.\\
\vspace{1cm}
The $95\%$ limits of agreement, estimated by mean difference +/- 1.96 standard deviation of the differences, provide an interval within which $95\%$ of differences between measurements by the two methods are expected to lie.
}

%-------------------------------------------------------------------------------------%

\frame{\frametitle{Inter-method bias}


}


%-------------------------------------------------------------------------------------%
%
%\frame{\frametitle{Repeatability}
%Repeatability is relevant to the study of method comparison
%because the repeatabilities of the two methods of measurement
%limit the amount of agreement which is possible. If one method has
%poor repeatability i.e. there is considerable variation in
%repeated measurements on the same subject, the agreement between
%the two methods is bound to be poor too. When the old method is
%the more variable one, even a new method which is perfect will not
%agree with it. If both methods have poor repeatability, the
%problem is even worse.
%
%The best way to examine repeatability is to take repeated
%measurements on a series of subjects.
%}
%----------------------------------------------------------------------------------------------%
\frame{\frametitle{Popularity of Bland-Altman plot}
Bland and Altman's 1986 paper has become ubiquitous in literature, with 18,860 citations.
\\
Deming Regression
}


\section{PEFR Example}
%------------------------------------------------------------------------------------GOOD--%
\frame{\frametitle{PEFR Data}
\begin{itemize}
\item This example uses data from Bland and Altman (1986): two measurements of peak
expiratory flow rate (PEFR) are compared. One of these measurements uses a ``Large" meter
and the other a ``Mini" meter.
\item The research question of interest is whether these two techniques
are measuring the same phenomenon.
\end{itemize}
}

%------------------------------------------------------------------------------------GOOD--%

\frame{\frametitle{PEFR}
\begin{tabular}{|c|c|c|c|c|}
  \hline
 & First PEFR    & Second PEFR   & First PEFR    &  Second PEFR\\
 \hline
Subject &    (l/min)    &(l/mi)&     (l/min)&    (l/min)\\
1&   494&    490    & 512    & 525 \\
2&   395&    397    & 430    & 415 \\
3&   516&    512    & 520    & 508 \\
4&   434&    401    &  428   & 444 \\
\vdots &   \vdots &    \vdots     &  \vdots   & \vdots \\
  \hline
\end{tabular}
}
%------------------------------------------------------------------------------------GOOD--%
\frame{\frametitle{Scatter plot for PEFR data}
\begin{center}
\includegraphics[width=8cm]{wright-meter-scatterplot.pdf}
\end{center}
}
%------------------------------------------------------------------------------------GOOD--%
\frame{\frametitle{Bland-Altman plot for PEFR data}
\begin{center}
\includegraphics[width=8cm]{wright-meter-scatterplot.pdf}
\end{center}
}



%----------------------------------------------------------------------------------------------%
\frame{\frametitle{Repeatability}
\begin{description}
  \item[Repeatability] - whereby a method agrees with itself
  \item[Repeatability] - Within-subject variability (relevant to future tests)
\end{description}
}

%----------------------------------------------------------------------------------------------%
\frame{\frametitle{Bland - Altman Plot}

\begin{description}
  \item[Repeatability] - whereby a method agrees with itself
  \item[Three variability tests] - Roy demonstrates 3 formal tests for variability
  \item[Correlation] There should be an correlation of 0.82.
  \item[Numeric data - Continuous numeric data] Data which can assume an infinite number of values (including decimal places)
  between any two given values \textit{e.g.} height.
  \item[Numeric data - Discrete numeric data] Data that can only have a finite number of numeric values (whole numbers only) \textit{e.g.}
  family size.
\end{description}
}
%%----------------------------------------------------------------------------------------------%

\frame{\frametitle{LME models for repeated measurements}
\begin{description}
  \item[Three criteria] Hamlett (19XX)
  \item[Three variability tests] - Roy demonstrates 3 formal tests for variability
  \item[Correlation] There should be an correlation of 0.82.
\end{description}
}
%----------------------------------------------------------------------------------------------%
\section{Roy's Methodology}
\frame{\frametitle{Roy's Methodology}
\begin{description}
  \item[Three criteria] Bias, variability and Correlation
  \item[Three variability tests] - Roy demonstrates 3 formal tests for variability
  \item[Correlation] There should be an correlation of 0.82.
\end{description}
}


%----------------------------------------------------------------------------------------------%
\frame{\frametitle{Bland - Altman Plot : Multiple measurements}

The Bland-Altman plot is constructed for a single pair of measurements.\\
\vspace{0.2cm}
Bland and Altman (1999) extend the limits of agreement approach to data with repeated measurements, proposing new estimates for equal numbers of replicates by each method on each subject, for unequal numbers of replicates, and for replicated data collected in pairs, where the underlying value of the quantity being measured is changing.


}
%%----------------------------------------------------------------------------------------------%
\begin{frame}[fragile]
\frametitle{Roy's Methodology  R implementation}

Roy's methodology requires the construction of four very similar LME models.
The first of Roy's candidate model (MCS1) can be implemented using the following code;\\
\begin{verbatim}
   MCS1 = lme(BP ~ method-1, data = dat,
   random = list(subject=pdSymm(~ method-1)),
   weights = varIdent(form=~1|method),
   correlation = corSymm(form=~1 | subject/obs), method="ML")
\end{verbatim}
The other three candidate models are constructed by using the same code, but exchanging the phrase ``CompSymm" for ``Symm" when appropriate.
\end{frame}
%----------------------------------------------------------------------------------------------%
\begin{frame}[fragile]\frametitle{Roy's fixed effects estimates}
\textbf{Fixed Effects estimates:}\\
The fixed effects estimates of any model can be used to determine the Inter-method bias. To compute the inter-method bias simple subtract one estimate from the other. \\However , to obtain explicit parameter estimates, such as p-value, a variation of the code, specifying a intercept, can be used;
\begin{verbatim}
   MCS1 = lme(BP ~ method, data = dat, ......
\end{verbatim}

\end{frame}





%----------------------------------------------------------------------------------------------%
\begin{frame}\frametitle{Linear Mixed Effects model (contd) }

\begin{itemize}
\item Of particular interest is the variance estimates associated with the random effects parameters\[
\mathrm{var}
\left(
              \begin{array}{c}
                b \\
                \epsilon \\
              \end{array}
            \right)
   =
\left(
         \begin{array}{cc}
           D & 0 \\
           0 & \Sigma \\
         \end{array}
       \right)
\]
\end{itemize}
\end{frame}

%----------------------------------------------------------------------------------------------%
\frame{\frametitle{Replicate Measurements}
\begin{itemize}
\item In comparison, multiple observation are often made with each method on the same subject.
\item These observations can be considered as replicate measurements if the observations with the same method on the same subject are conditionally independent and identically distributed.
\end{itemize}
}


%----------------------------------------------------------------------------------------------%

\frame{\frametitle{JSR Data}
JSR Data
Roy includes a table from Bland and Altman's 1999 paper which shows a set of systolic blood pressure data from a study in which simultaneous measurements were made by each of two experienced observers (denoted J and R) using a sphygmomanometer and by a semi-automatic blood pressure monitor (denoted S).


 Three sets of readings were made in quick succession.
 }
 

%----------------------------------------------------------------------------------------------%
\frame{\frametitle{JSR Data (contd)}
\begin{tabular}{|c|c|c|c|}
  \hline
  Observation   & Subject   & Method    &  Replicate \\
 \hline
   1 &    490    & 512    & 525 \\
   2 &    397    & 430    & 415 \\
   3 &    512    & 520    & 508 \\
   4 &    401    &  428   & 444 \\
   5 &    512    & 520    & 508 \\
   434&    401    &  428   & 444 \\
   \vdots &    \vdots     &  \vdots   & \vdots \\
  \hline
\end{tabular}
}


%----------------------------------------------------------------------------------------------%
\section{LME Models}
\begin{frame}\frametitle{Linear Mixed Effects model}

\begin{itemize}
\item A linear mixed effects (LME) model is a statistical model containing both fixed effects and random effects.
\item LME models are a generalization of the classical linear model, which contain fixed effects only.
\item
LME models are commonly formulated in the notation described in Laird and Ware (1982)
\[
y = X\beta + Zb + \epsilon
\label{LW}
\]
\end{itemize}
\end{frame}
%----------------------------------------------------------------------------------------------%
\begin{frame}\frametitle{Variance Structures }
\begin{itemize}
\item The Identity variance structures is commonly used in LME models.
\[\left(
        \begin{array}{cc} \sigma^2_{1} &  \sigma_{12} \\   \sigma_{21} &  \sigma^2_{2} \\ \end{array}
       \right)
\]
\end{itemize}
% \begin{array}{cc} \sigma^2_{1} &  \sigma_{12} \\   \sigma_{21} &  \sigma^2_{2} \\ \end{array}
Identity:  Diagonal terms are equal. Off Diagonal terms are zero.
\\Compound Symmetry: Diagonal terms are equal. Otherwise unconstrained.
\\Symmetric (also known as unstructured): Positive definite symmetric matrix.


\end{frame}
%----------------------------------------------------------------------------------------------%
\begin{frame}\frametitle{Limits of Agreement}
\textbf{General LME models:}\\
Bendix Carstensen et al demonstrate a method of computing the limits of agreement using simple LME models. However, if the observations are assumed to be linked, an extra interaction term must be added to Carstensen LME model.\\
\vspace{0.2cm}
\textbf{Roy's LME models:}\\
Roy's LME models can also be used to compute the limits of agreement. The formulation of the model already accounts for linkage, so no additional terms are necessary.
\vspace{0.1cm}Limits of agreement are not given explicitly in the code output, but a simple \texttt{R} function can be used to construct them.
\end{frame}

%----------------------------------------------------------------------------------------------%
\begin{frame}[fragile]\frametitle{Roy's likelihood ratio tests}
\textbf{Comparing Models:}\\
A form test may be implemented using a likelihood ration test, implemented in \texttt{R} with the \texttt{anova()}command.
\begin{verbatim}
> anova(MCS1,MCS2)
      Model df AIC    BIC    logLik  Test   L.Ratio  p-value
MCS1  1     8  4077.5 4111.3 -2030.7
MCS2  2     7  4075.6 4105.3 -2030.8 1 vs 2 0.15291  0.6958
>
\end{verbatim}
Further to this test, we fail to reject the model MCS1 in favour of MCS2.
Therefore we conclude both methods have the same between-subject variance.
\end{frame}

%----------------------------------------------------------------------------------------------%
\section{Model Diagnostics}
\begin{frame}\frametitle{LME Diagnostics for LME models}

\begin{itemize}
\item Cook and Weisberg (1982) developed case deletion model diagnostics, such as Cook's distance for linear models.
\item Christensen, Pearson and Johnson (1992) examined case deletion diagnostics, in particular the LME equivalent
of Cook’s distance, for assessing influential observations in LME models.

\item Haslett and Hayes (1998) presented a general theory for residuals in the general linear model (GLM) framework, in which marginal and conditional residuals are described.
    
%\item Considering LMEs as augmented GLMs, it is proposed to apply Haslett and Hayes's approach to method comparison studies.
\end{itemize}



\end{frame}

%----------------------------------------------------------------------------------------------%
\section{LMEs as Augmented GLMs}
\begin{frame}\frametitle{Henderson Equation}
Henderson's Equation for estimating LME parameters can be formulated as
\[
\left(\begin{array}{cc}
  X^\prime\Sigma^{-1}X & X^\prime\Sigma^{-1}Z
  \\
  Z^\prime\Sigma^{-1}X & X^\prime\Sigma^{-1}X + D^{-1}
  \end{array}\right)
\left(\begin{array}{c}
    \beta \\
  b
  \end{array}\right)
  =
\left(\begin{array}{c}
  X^\prime\Sigma^{-1}y \\
  Z^\prime\Sigma^{-1}y
  \end{array}\right).\]


Henderson's equations can be rewritten as a GLM model in form $( T^\prime W^{-1} T ) \delta = T^\prime W^{-1} y_{a} $ using
\[
\delta = \left(\begin{array}{c}\beta \\ b \end{array}\right),
\ y_{a} = \left(\begin{array}{c}
  y \cr \psi
  \end{array}\right),
\ T = \left(\begin{array}{cc}
  X & Z  \\
  0 & I
  \end{array}\right),
\ \textrm{and} \ W = \left(\begin{array}{cc}
  \Sigma & 0  \cr
  0 &  D \end{array}\right),
\]
 
($\psi$ represents ``quasi-data", a construct used to analyze GLMs.)
 
\end{frame}

%----------------------------------------------------------------------------------------------%

\begin{frame}\frametitle{LMEs as Augmented GLMs}

\begin{itemize}\item This augmented GLM formulation allows the analyses developed by Haslett and Hayes (1998) to be used on LME models. \item It is proposed to investigate diagnostic measures, such as residuals Mahalanobis distances, for validating method comparison studies.\\
\end{itemize}



\end{frame}


%-------------------------------------------------------------------------------------%

\section{Bibliography}
\begin{frame}\frametitle{Bibliography}
\begin{itemize}
\item D.G Altman and J.M. Bland (1983) - Measuring agreement in method comparison studies. ( \textit{Statistical Methods in Medical Research} ; \textbf{8}:135--160.)
\item J.M. Bland  and D.G Altman  (1986) - Measuring agreement in method comparison studies. ( \textit{Statistical Methods in Medical Research} ; \textbf{8}:135--160.)
\item J.M. Bland  and D.G Altman  (1999) - Measuring agreement in method comparison studies. ( \textit{Statistical Methods in Medical Research} ; \textbf{8}:135--160.)
\item N.M. Laird and J.H Ware (1982) - Random-Effects Models for Longitudinal Data, ( \textit{Biometrics}, \textbf{38}: 963–974.)
\end{itemize}
\end{frame}
%----------------------------------------------------------------------------------------------%
\begin{frame}\frametitle{Bibliography (contd)}
\begin{itemize}
\item Hamlett et al (1983) - Measuring agreement in method comparison studies. ( \textit{Statistical Methods in Medical Research} ; \textbf{8}:135--160.)
\item Carstensen   (2008) - Measuring agreement in method comparison studies. ( \textit{Statistical Methods in Medical Research} ; \textbf{8}:135--160.)
\item Anuradha Roy (2009) - Random-Effects Models for Longitudinal Data, ( \textit{Biometrics}, \textbf{38}: 963–974.)
\end{itemize}
\end{frame}


%----------------------------------------------------------------------------------------------%









\end{document}
